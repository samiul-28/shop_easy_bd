<h1><%= t('products.index.title') %></h1>

<!-- Filter form: Automatically submits when a category is selected -->
<div class="mb-3">
  <%= form_with url: products_path, method: :get, local: true, id: "product-filter-form" do %>
    <div class="row g-2">
      <div class="col-md-4">
        <%= select_tag :category_id,
          options_from_collection_for_select(Category.all, :id, :name_en, @category_id),
          include_blank: "All Categories",
          class: "form-select",
          onchange: "this.form.submit();" # auto-submit when changed
        %>
      </div>
    </div>
  <% end %>
</div>

<div class="row">
  <% @products.each do |product| %>
    <div class="col-md-3 mb-4">
      <div class="card h-100 d-flex flex-column">
        <% if product.image.attached? %>
          <%= link_to product_path(product) do %>
            <%= image_tag product.image, class: "card-img-top", style: "height:200px; object-fit:cover;" %>
          <% end %>
        <% end %>
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-truncate">
            <%= I18n.locale == :bn ? product.name_bn : product.name_en %>
          </h5>
          <p class="card-text">à§³ <%= product.price %></p>
          <%= button_to 'Add to cart',
              cart_items_path(product_id: product.id),
              method: :post,
              class: "btn btn-success mt-auto" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<% if @products.empty? %>
  <div class="alert alert-info">
    <%= t('products.index.no_products') %>
  </div>
<% end %>
